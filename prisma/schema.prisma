generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider  = "postgresql"
  url       = env("STORAGE_PRISMA_URL")
  directUrl = env("STORAGE_URL_NON_POOLING")
}

model Client {
  id        String    @id @default(cuid())
  name      String
  email     String?
  phone     String
  company   String?
  projects  Project[]
  createdAt DateTime  @default(now())
  updatedAt DateTime  @updatedAt
}

model Project {
  id           String          @id @default(cuid())
  orderId      String          @unique
  name         String
  type         String
  description  String?
  status       String          @default("consultation")
  progress     Int             @default(0)
  startDate    DateTime?
  estimatedEnd DateTime?
  totalCost    String?
  paidAmount   String?
  client       Client          @relation(fields: [clientId], references: [id])
  clientId     String
  stages       ProjectStage[]
  updates      ProjectUpdate[]
  createdAt    DateTime        @default(now())
  updatedAt    DateTime        @updatedAt
}

model ProjectStage {
  id        String   @id @default(cuid())
  name      String
  order     Int
  status    String   @default("pending")
  progress  Int      @default(0)
  project   Project  @relation(fields: [projectId], references: [id])
  projectId String
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

model ProjectUpdate {
  id        String   @id @default(cuid())
  message   String
  type      String   @default("update")
  fileUrl   String?
  project   Project  @relation(fields: [projectId], references: [id])
  projectId String
  createdAt DateTime @default(now())
}
